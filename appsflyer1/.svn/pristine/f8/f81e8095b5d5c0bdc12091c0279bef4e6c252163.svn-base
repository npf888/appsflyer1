package com.ami.bazoo.action;

import java.util.Calendar;
import java.util.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

import com.ami.api.exception.APIException;
import com.ami.api.web.action.BaseAction;
import com.ami.bazoo.pojo.BazooRoomVO;
import com.ami.bazoo.pojo.BazooTaskVO;
import com.ami.bazoo.service.BazooService;
import com.ami.common.TimeUtil;

/**
 * 
 * 吹牛后台
 * @author JavaServer
 *
 */
@SuppressWarnings("serial")
@Scope("prototype")
@Component
public class BazooAction extends BaseAction{

	@Autowired
	private BazooService bazooService;
	
	 public String queryList() throws APIException
	    {
	        
	        
		 	List<BazooRoomVO> list = bazooService.queryList(this.getReq());
		 	if(list != null && list.size()>0){
		 		for(BazooRoomVO vo:list){
		 			List<BazooTaskVO> taskList = vo.getBazooTaskVOS();
		 			for(BazooTaskVO task:taskList){
		 				task.setTimeStr(TimeUtil.formatLongTOStr(task.getTime()));
		 				String idStr = "";
		 				for(Long id:task.getNextPlayerIds()){
		 					idStr+=id+",";
		 				}
		 				task.setIdsStr(idStr.substring(0, idStr.length()-1));
		 			}
		 		}
		 	}
	        this.set("list", list);
	        return "index";
	    }
	 public String shutDownThread() throws APIException
	 {
		 
		 String passportId = this.get("passportId");
		 bazooService.shutDownThread(passportId);
		 return "redirectIndex";
		 
	 }
	 public String delete() throws APIException
	 {
		 
		 String passportId = this.get("passportId");
		 bazooService.delete(passportId);
		 
		 return "redirectIndex";
	 }
	 
}
